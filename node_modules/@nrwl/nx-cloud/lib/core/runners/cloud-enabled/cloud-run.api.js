const a3_0x3862=['then','mapRespToPerfEntry','promisify','axiosException','axiosMultipleTries','Invalid\x20Nx\x20Cloud\x20response:\x20','getBranch','runContext','createMetricRecorder','response','terminalOutput','Run\x20Details:','messages','application/octet-stream','...','createReqBody','message','zlib','done','__esModule','apiError','assign','slice','machineInfo','endRun','RUNNER_FAILURE_PERF_ENTRY','Stack\x20Trace:','RunStart','VERBOSE_LOGGING','data','@nrwl/nx-cloud','stringify','/nx-cloud/runs/end','apiAxiosInstance','next','post','recordMetric','nxCloudVersion','error','toString','devDependencies','readFileSync','from','length','note','urls','string','createApiAxiosInstance','status','defineProperty','../../../utilities/axios','package.json','../../../utilities/environment','map','Run\x20completion\x20responded\x20with\x20`undefined`.','startRun','CloudRunApi','runUrl','RunEnd.\x20Completed\x20tasks','success','gzip','unknown','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','../../../utilities/metric-logger'];(function(_0x4a4e3f,_0x386240){const _0x16619a=function(_0x59fcd4){while(--_0x59fcd4){_0x4a4e3f['push'](_0x4a4e3f['shift']());}};_0x16619a(++_0x386240);}(a3_0x3862,0x19c));const a3_0x1661=function(_0x4a4e3f,_0x386240){_0x4a4e3f=_0x4a4e3f-0x0;let _0x16619a=a3_0x3862[_0x4a4e3f];return _0x16619a;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x218240,_0x151ed8,_0x5d2e28,_0x1a71a1){function _0xeae7dd(_0x423073){return _0x423073 instanceof _0x5d2e28?_0x423073:new _0x5d2e28(function(_0x9fa3f0){_0x9fa3f0(_0x423073);});}return new(_0x5d2e28||(_0x5d2e28=Promise))(function(_0x56110e,_0x5e3d08){function _0x46ecfa(_0x4b2a8c){try{_0x3beb9f(_0x1a71a1[a3_0x1661('0x6')](_0x4b2a8c));}catch(_0x307c06){_0x5e3d08(_0x307c06);}}function _0x446a00(_0x3d55a6){try{_0x3beb9f(_0x1a71a1['throw'](_0x3d55a6));}catch(_0x2014e3){_0x5e3d08(_0x2014e3);}}function _0x3beb9f(_0x46018a){_0x46018a[a3_0x1661('0x36')]?_0x56110e(_0x46018a['value']):_0xeae7dd(_0x46018a['value'])[a3_0x1661('0x24')](_0x46ecfa,_0x446a00);}_0x3beb9f((_0x1a71a1=_0x1a71a1['apply'](_0x218240,_0x151ed8||[]))[a3_0x1661('0x6')]());});};Object[a3_0x1661('0x15')](exports,a3_0x1661('0x37'),{'value':!![]});exports[a3_0x1661('0x1c')]=void 0x0;const axios_1=require(a3_0x1661('0x16'));const environment_1=require(a3_0x1661('0x18'));const fs_1=require('fs');const zlib_1=require(a3_0x1661('0x35'));const util_1=require('util');const metric_logger_1=require(a3_0x1661('0x23'));const {output}=require('../../../utilities/nx-imports');class CloudRunApi{constructor(_0x2b7c70,_0x529f7e,_0xcfc78c,_0x1dac4f){this[a3_0x1661('0x30')]=_0x2b7c70;this[a3_0x1661('0x2b')]=_0x529f7e;this[a3_0x1661('0x3b')]=_0x1dac4f;this['apiAxiosInstance']=(0x0,axios_1[a3_0x1661('0x13')])(_0xcfc78c);}[a3_0x1661('0x1b')](_0x149d4f,_0x411f9f){var _0xcff0c0;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x58f0ce=(0x0,metric_logger_1[a3_0x1661('0x2c')])(a3_0x1661('0x1b'));try{const _0x87b4dc={'meta':{'nxCloudVersion':this[a3_0x1661('0x9')]()},'branch':(0x0,environment_1[a3_0x1661('0x2a')])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'distributedExecutionId':_0x149d4f,'hashes':_0x411f9f};if(environment_1['VERBOSE_LOGGING']){output[a3_0x1661('0x10')]({'title':a3_0x1661('0x3f'),'bodyLines':['\x0a'+JSON[a3_0x1661('0x3')](_0x87b4dc,null,0x2)]});}const _0x2827b3=yield(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x1661('0x5')][a3_0x1661('0x7')]('/nx-cloud/runs/start',_0x87b4dc));_0x58f0ce['recordMetric']((0x0,metric_logger_1[a3_0x1661('0x25')])(_0x2827b3));if(_0x2827b3['data']&&_0x2827b3[a3_0x1661('0x1')][a3_0x1661('0x34')]){this[a3_0x1661('0x30')]['message']=_0x2827b3[a3_0x1661('0x1')]['message'];}if(!_0x2827b3['data']||!_0x2827b3[a3_0x1661('0x1')][a3_0x1661('0x11')]){this[a3_0x1661('0x30')][a3_0x1661('0x38')]=a3_0x1661('0x29')+JSON[a3_0x1661('0x3')](_0x2827b3[a3_0x1661('0x1')]);return{};}return _0x2827b3[a3_0x1661('0x1')][a3_0x1661('0x11')];}catch(_0x3a6fe7){_0x58f0ce[a3_0x1661('0x8')](((_0xcff0c0=_0x3a6fe7===null||_0x3a6fe7===void 0x0?void 0x0:_0x3a6fe7['axiosException'])===null||_0xcff0c0===void 0x0?void 0x0:_0xcff0c0[a3_0x1661('0x2d')])?(0x0,metric_logger_1[a3_0x1661('0x25')])(_0x3a6fe7['axiosException'][a3_0x1661('0x2d')]):metric_logger_1[a3_0x1661('0x3d')]);this[a3_0x1661('0x30')]['apiError']=this[a3_0x1661('0x30')]['extractErrorMessage'](_0x3a6fe7,'api');return{};}});}[a3_0x1661('0x33')](_0x2a6b36,_0x3935f6,_0x405805){const _0x4fa107={'meta':{'nxCloudVersion':this['nxCloudVersion']()},'tasks':_0x3935f6,'run':_0x2a6b36,'linkId':_0x405805,'machineInfo':this[a3_0x1661('0x3b')]};return JSON['stringify'](_0x4fa107);}[a3_0x1661('0x3c')](_0x2a9136,_0x23db01,_0x129f2f){var _0x467d3d,_0x149768;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x1661('0x30')][a3_0x1661('0x38')])return![];let _0x1cc52a=this[a3_0x1661('0x33')](_0x2a9136,_0x23db01,_0x129f2f);if(_0x1cc52a[a3_0x1661('0xf')]>0x14*0x3e8*0x3e8){_0x1cc52a=this[a3_0x1661('0x33')](_0x2a9136,_0x23db01['map'](_0x57010f=>Object[a3_0x1661('0x39')](Object['assign']({},_0x57010f),{'hashDetails':undefined})));}const _0xa9285b=Buffer[a3_0x1661('0xe')](_0x1cc52a);const _0x28099e=yield(0x0,util_1[a3_0x1661('0x26')])(zlib_1[a3_0x1661('0x20')])(_0xa9285b);const _0x432f16=(0x0,metric_logger_1[a3_0x1661('0x2c')])(a3_0x1661('0x3c'));try{if(environment_1[a3_0x1661('0x0')]){const _0x381235=_0x23db01[a3_0x1661('0x19')](_0x361419=>{return Object[a3_0x1661('0x39')](Object[a3_0x1661('0x39')]({},_0x361419),{'terminalOutput':_0x361419[a3_0x1661('0x2e')]?_0x361419['terminalOutput'][a3_0x1661('0x3a')](0x0,0x14)+a3_0x1661('0x32'):undefined});});output['note']({'title':a3_0x1661('0x1e'),'bodyLines':['\x0a'+JSON[a3_0x1661('0x3')](_0x381235,null,0x2)]});}const _0x1e0188=yield(0x0,axios_1[a3_0x1661('0x28')])(()=>this[a3_0x1661('0x5')][a3_0x1661('0x7')](a3_0x1661('0x4'),_0x28099e,{'headers':Object[a3_0x1661('0x39')](Object[a3_0x1661('0x39')]({},this[a3_0x1661('0x5')]['defaults']['headers']),{'Content-Encoding':'gzip','Content-Type':a3_0x1661('0x31')})}));if(_0x1e0188){_0x432f16['recordMetric']((0x0,metric_logger_1[a3_0x1661('0x25')])(_0x1e0188));if(_0x1e0188[a3_0x1661('0x1')]&&_0x1e0188[a3_0x1661('0x1')][a3_0x1661('0x1d')]&&_0x1e0188[a3_0x1661('0x1')][a3_0x1661('0x14')]==='success'){this['runContext']['runUrl']=_0x1e0188[a3_0x1661('0x1')][a3_0x1661('0x1d')];return!![];}if(_0x1e0188[a3_0x1661('0x1')]&&_0x1e0188[a3_0x1661('0x1')][a3_0x1661('0x14')]){this[a3_0x1661('0x30')]['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON['stringify'](_0x1e0188['data'][a3_0x1661('0x34')]);}else if(_0x1e0188[a3_0x1661('0x1')]&&typeof _0x1e0188[a3_0x1661('0x1')]===a3_0x1661('0x12')){if(_0x1e0188[a3_0x1661('0x1')]!==a3_0x1661('0x1f')){this[a3_0x1661('0x30')]['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON['stringify'](_0x1e0188[a3_0x1661('0x1')]);}}else{this[a3_0x1661('0x30')][a3_0x1661('0x38')]='Invalid\x20end\x20run\x20response:\x20'+JSON['stringify'](_0x1e0188[a3_0x1661('0x1')]);}if(environment_1[a3_0x1661('0x0')]){output['note']({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON[a3_0x1661('0x3')](_0x1e0188[a3_0x1661('0x1')],null,0x2)]});}}else{output[a3_0x1661('0xa')]({'title':a3_0x1661('0x22'),'bodyLines':[a3_0x1661('0x1a'),a3_0x1661('0x2f'),JSON[a3_0x1661('0x3')](_0x2a9136,null,0x2),a3_0x1661('0x3e'),JSON[a3_0x1661('0x3')](new Error()['stack'],null,0x2)]});}return![];}catch(_0x3ae8e5){_0x432f16[a3_0x1661('0x8')](((_0x467d3d=_0x3ae8e5===null||_0x3ae8e5===void 0x0?void 0x0:_0x3ae8e5[a3_0x1661('0x27')])===null||_0x467d3d===void 0x0?void 0x0:_0x467d3d['response'])?(0x0,metric_logger_1[a3_0x1661('0x25')])(_0x3ae8e5['axiosException']['response']):metric_logger_1[a3_0x1661('0x3d')]);const _0x291cb9=(_0x149768=_0x3ae8e5[a3_0x1661('0x27')])!==null&&_0x149768!==void 0x0?_0x149768:_0x3ae8e5;this[a3_0x1661('0x30')][a3_0x1661('0x38')]=this[a3_0x1661('0x30')]['extractErrorMessage'](_0x291cb9,'api');return![];}});}[a3_0x1661('0x9')](){try{const _0x2b6bf3=JSON['parse']((0x0,fs_1[a3_0x1661('0xd')])(a3_0x1661('0x17'))[a3_0x1661('0xb')]());return _0x2b6bf3[a3_0x1661('0xc')][a3_0x1661('0x2')];}catch(_0x2942b3){return a3_0x1661('0x21');}}}exports[a3_0x1661('0x1c')]=CloudRunApi;