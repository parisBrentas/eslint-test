const a1_0x49ae=['./id-generator','printMessages','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','printCacheHitsMessage','extractGitSha','then','processInBackground','waitForStoreRequestsToComplete','https://nx.app','hash','catch','throw','../../../utilities/environment','accessToken','getRunGroup','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','./cloud-enabled-life-cycle','map','anyErrors','all','error','../../../utilities/nx-imports','uploads','join','ACCESS_TOKEN','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','ErrorReporterApi','skipNxCache','ENCRYPTION_KEY','obfuscate','message','runUrl','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','getMachineInfo','next','daemon','Executed\x20tasks\x20with\x20hashes:\x20','parseCommand','../../terminal-output/output-obfuscator','__awaiter','tasks-hashes-','.nx.app','/runs/','getBranch','generateUniqueLinkId','length','../../../utilities/metric-logger','lifeCycle','note','value','cloudEnabledTasksRunner','startRun','VERBOSE_LOGGING','scan','toISOString','url','assign','env','submitRunMetrics','writeFileSync','E2EEncryption','rxjs/internal/Subject','warn','OutputObfuscator','endRun','done','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.','apply','@nrwl/nx-cloud/lib/daemon/process-run-end','../../terminal-output/end-of-run-message','../../file-storage/e2e-encryption','subscribe','localhost','cacheableOperations','maskedProperties','defineProperty','pathExists','./cloud-run.api','toString','FileStorage','fs-extra','MessageReporter','cacheDirectory','path','exit','../../terminal-output/message-reporter','taskId'];(function(_0x163a3b,_0x49aecd){const _0x16c953=function(_0x310437){while(--_0x310437){_0x163a3b['push'](_0x163a3b['shift']());}};_0x16c953(++_0x49aecd);}(a1_0x49ae,0xc1));const a1_0x16c9=function(_0x163a3b,_0x49aecd){_0x163a3b=_0x163a3b-0x0;let _0x16c953=a1_0x49ae[_0x163a3b];return _0x16c953;};'use strict';var __awaiter=this&&this[a1_0x16c9('0x14')]||function(_0x26f03f,_0x1d8aff,_0xd195c8,_0x25329d){function _0x11f0db(_0x54fa0a){return _0x54fa0a instanceof _0xd195c8?_0x54fa0a:new _0xd195c8(function(_0x81c062){_0x81c062(_0x54fa0a);});}return new(_0xd195c8||(_0xd195c8=Promise))(function(_0x3db728,_0x55fd79){function _0x51bb7f(_0xc259e6){try{_0xef392a(_0x25329d[a1_0x16c9('0xf')](_0xc259e6));}catch(_0x4e29f9){_0x55fd79(_0x4e29f9);}}function _0x1ea208(_0x3079c0){try{_0xef392a(_0x25329d[a1_0x16c9('0x4f')](_0x3079c0));}catch(_0x2feada){_0x55fd79(_0x2feada);}}function _0xef392a(_0x9a5f9f){_0x9a5f9f[a1_0x16c9('0x2e')]?_0x3db728(_0x9a5f9f[a1_0x16c9('0x1e')]):_0x11f0db(_0x9a5f9f[a1_0x16c9('0x1e')])[a1_0x16c9('0x49')](_0x51bb7f,_0x1ea208);}_0xef392a((_0x25329d=_0x25329d[a1_0x16c9('0x30')](_0x26f03f,_0x1d8aff||[]))[a1_0x16c9('0xf')]());});};Object[a1_0x16c9('0x38')](exports,'__esModule',{'value':!![]});exports[a1_0x16c9('0x1f')]=void 0x0;const message_reporter_1=require(a1_0x16c9('0x42'));const end_of_run_message_1=require(a1_0x16c9('0x32'));const output_obfuscator_1=require(a1_0x16c9('0x13'));const cloud_enabled_life_cycle_1=require(a1_0x16c9('0x54'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require(a1_0x16c9('0x33'));const environment_1=require(a1_0x16c9('0x50'));const cloud_remote_cache_1=require('./cloud-remote-cache');const cloud_run_api_1=require(a1_0x16c9('0x3a'));const fs_1=require('fs');const path=require(a1_0x16c9('0x40'));const metric_logger_1=require(a1_0x16c9('0x1b'));const error_reporter_api_1=require('../../api/error-reporter.api');const path_1=require('path');const fs_extra_1=require(a1_0x16c9('0x3d'));const id_generator_1=require(a1_0x16c9('0x44'));const {tasksRunner,output,Cache}=require(a1_0x16c9('0x2'));function createApi(_0x3b0568,_0x460e6f,_0x5317dd){const _0x563fd2=(0x0,environment_1[a1_0x16c9('0xe')])(_0x460e6f);return new cloud_run_api_1['CloudRunApi'](_0x3b0568,_0x5317dd,_0x460e6f,_0x563fd2);}function storeTaskHashes(_0x2c8b33,_0x59d541,_0x3a43e2){const _0x4f502c=JSON['stringify'](_0x2c8b33[a1_0x16c9('0x55')](_0x25848e=>({'taskId':_0x25848e[a1_0x16c9('0x43')],'hash':_0x25848e[a1_0x16c9('0x4d')]})));if(environment_1[a1_0x16c9('0x21')]){output[a1_0x16c9('0x1d')]({'title':a1_0x16c9('0x11')+_0x4f502c});}(0x0,fs_1[a1_0x16c9('0x28')])(path[a1_0x16c9('0x4')](_0x59d541,a1_0x16c9('0x15')+_0x3a43e2),_0x4f502c);}function onComplete({daemon,lifeCycle,options,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,fileStorage,uploadInCurrentProcess,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x23acba=new Date()[a1_0x16c9('0x23')]();const _0x54a569=(0x0,environment_1[a1_0x16c9('0x18')])();const _0x51621f={'command':outputObfuscator[a1_0x16c9('0xa')]((0x0,environment_1[a1_0x16c9('0x12')])()),'startTime':runStartTime,'endTime':_0x23acba,'distributedExecutionId':environment_1[a1_0x16c9('0x6')],'branch':_0x54a569,'scan':!![],'runGroup':(0x0,environment_1[a1_0x16c9('0x52')])(),'sha':_0x54a569?(0x0,environment_1[a1_0x16c9('0x48')])():undefined,'inner':inner};if(uploadInCurrentProcess){if(environment_1[a1_0x16c9('0x46')]){storeTaskHashes(taskExecutions,options[a1_0x16c9('0x3f')]||'./node_modules/.cache/nx',environment_1[a1_0x16c9('0x6')]);}try{yield remoteCache[a1_0x16c9('0x4b')]();}catch(_0x197cf7){output[a1_0x16c9('0x1')]({'title':a1_0x16c9('0x53')});messages[a1_0x16c9('0x45')]();process[a1_0x16c9('0x41')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}try{yield api[a1_0x16c9('0x2d')](_0x51621f,taskExecutions);}catch(_0x3ca43f){output['error']({'title':a1_0x16c9('0x2f')});messages['printMessages']();process[a1_0x16c9('0x41')](environment_1[a1_0x16c9('0xd')]);}yield(0x0,metric_logger_1[a1_0x16c9('0x27')])(options);}else{try{const _0x1d43e2=environment_1[a1_0x16c9('0x5')]?environment_1[a1_0x16c9('0x5')]:options[a1_0x16c9('0x51')];const _0x4fb3b4=(0x0,id_generator_1[a1_0x16c9('0x19')])();yield daemon[a1_0x16c9('0x4a')](a1_0x16c9('0x31'),{'encryptionKey':encryptionKey,'runnerOptions':Object['assign'](Object[a1_0x16c9('0x25')]({},options),{'accessToken':_0x1d43e2}),'uploads':fileStorage[a1_0x16c9('0x3')],'runEnd':{'runData':_0x51621f,'taskExecutions':taskExecutions,'linkId':_0x4fb3b4}});runContext[a1_0x16c9('0xc')]=(options[a1_0x16c9('0x24')]||a1_0x16c9('0x4c'))+a1_0x16c9('0x17')+_0x4fb3b4;}catch(_0x3cc244){output[a1_0x16c9('0x2b')]({'title':'Nx\x20Cloud\x20Problems','bodyLines':[_0x3cc244[a1_0x16c9('0xb')]||_0x3cc244[a1_0x16c9('0x3b')]()]});}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x16c9('0x45')]();if(!messages[a1_0x16c9('0x56')]&&!inner){endOfRunMessage[a1_0x16c9('0x47')]();}},0x0);}else{messages[a1_0x16c9('0x45')]();if(!messages[a1_0x16c9('0x56')]&&!inner){endOfRunMessage[a1_0x16c9('0x47')]();}}});}function createLifeCycle(_0x7c279,_0x9594cf,_0x34147e,_0x315363){const _0x117632=new cloud_enabled_life_cycle_1['CloudEnabledLifeCycle'](_0x7c279,_0x9594cf['cacheDirectory'],!!_0x9594cf[a1_0x16c9('0x8')],_0x9594cf['scan']===undefined?!![]:_0x9594cf[a1_0x16c9('0x22')],_0x9594cf[a1_0x16c9('0x36')]||[],_0x34147e,_0x315363);try{const {CompositeLifeCycle}=require(a1_0x16c9('0x2'));if(!CompositeLifeCycle)return _0x117632;return new CompositeLifeCycle([_0x9594cf['lifeCycle'],_0x117632]);}catch(_0x1f74c9){return _0x117632;}}function fetchUrlsForKnownHashesUpfront(_0x1a1561,_0x533527,_0x4dcf7d,_0x17e48d){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x5173e7=_0x4dcf7d['map'](_0x26cfc3=>_0x26cfc3['hash'])['filter'](_0x3b2485=>!!_0x3b2485);const _0x512757=new Cache(_0x17e48d);if(!_0x17e48d[a1_0x16c9('0x8')]){const _0x41f6c7=yield Promise[a1_0x16c9('0x0')](_0x5173e7[a1_0x16c9('0x55')](_0x118842=>{const _0x5e25a4=(0x0,path_1[a1_0x16c9('0x4')])(_0x512757['cachePath'],_0x118842+'.commit');return(0x0,fs_extra_1[a1_0x16c9('0x39')])(_0x5e25a4);}));const _0x4e8dcc=[];for(let _0x4b6333=0x0;_0x4b6333<_0x41f6c7[a1_0x16c9('0x1a')];++_0x4b6333){if(_0x41f6c7[_0x4b6333]){_0x4e8dcc['push'](_0x5173e7[_0x4b6333]);}}_0x5173e7=_0x4e8dcc;}if(_0x5173e7['length']>0x0){const _0x23a1f1=_0x1a1561[a1_0x16c9('0x20')](environment_1[a1_0x16c9('0x6')],_0x5173e7);for(const _0x15ae37 of _0x5173e7){_0x533527['requests'][_0x15ae37]=_0x23a1f1;}}});}function isConnectedToPrivateCloud(_0x3e3f86){if(!_0x3e3f86[a1_0x16c9('0x24')])return![];if(_0x3e3f86[a1_0x16c9('0x24')]['endsWith'](a1_0x16c9('0x16')))return![];if(_0x3e3f86[a1_0x16c9('0x24')]['indexOf'](a1_0x16c9('0x35'))>-0x1)return![];return!![];}function cloudEnabledTasksRunner(_0x77fde4,_0x3370b6,_0x2a1776,_0x49647f=![]){var _0x27c2e9;const _0x523a2f={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x77fde4};const _0x122771=_0x3370b6[a1_0x16c9('0x1c')]===undefined;const _0x301f29=[];const _0x199ddf=new message_reporter_1[(a1_0x16c9('0x3e'))](_0x3370b6);const _0x1d699d=createApi(_0x199ddf,_0x3370b6,_0x523a2f);const _0x50b9be=new end_of_run_message_1['EndOfRunMessage'](_0x523a2f,_0x301f29);const _0x29ff8c=new output_obfuscator_1[(a1_0x16c9('0x2c'))](_0x3370b6[a1_0x16c9('0x37')]);const _0x57882c=new Date()['toISOString']();const _0x200f1d=createLifeCycle(_0x523a2f,_0x3370b6,_0x29ff8c,_0x301f29);const _0x4a9e20=environment_1[a1_0x16c9('0x9')]||_0x3370b6['encryptionKey'];const _0xa89bbc=new e2e_encryption_1[(a1_0x16c9('0x29'))](_0x4a9e20);const _0x36db83=new error_reporter_api_1[(a1_0x16c9('0x7'))](_0x3370b6);const _0x48f654=!!environment_1[a1_0x16c9('0x46')]||!((_0x27c2e9=_0x2a1776[a1_0x16c9('0x10')])===null||_0x27c2e9===void 0x0?void 0x0:_0x27c2e9['enabled']())||isConnectedToPrivateCloud(_0x3370b6);const _0x49cbe9=new file_storage_1[(a1_0x16c9('0x3c'))](_0xa89bbc,_0x36db83,![],_0x48f654);const _0x3d5a81=new cloud_remote_cache_1['CloudRemoteCache'](_0x199ddf,_0x1d699d,_0x523a2f,_0x49cbe9);fetchUrlsForKnownHashesUpfront(_0x1d699d,_0x523a2f,_0x77fde4,_0x3370b6);delete process[a1_0x16c9('0x26')][a1_0x16c9('0x6')];const _0x423ca8=tasksRunner(_0x77fde4,Object[a1_0x16c9('0x25')](Object[a1_0x16c9('0x25')]({},_0x3370b6),{'remoteCache':_0x3d5a81,'lifeCycle':_0x200f1d}),_0x2a1776);if(_0x423ca8[a1_0x16c9('0x34')]){const {Subject}=require(a1_0x16c9('0x2a'));const _0x45fbc2=new Subject();_0x423ca8[a1_0x16c9('0x34')]({'next':_0x41cac3=>_0x45fbc2[a1_0x16c9('0xf')](_0x41cac3),'error':_0x56226d=>_0x45fbc2[a1_0x16c9('0x1')](_0x56226d),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x2a1776['daemon'],'lifeCycle':_0x200f1d,'options':_0x3370b6,'remoteCache':_0x3d5a81,'api':_0x1d699d,'outputObfuscator':_0x29ff8c,'runStartTime':_0x57882c,'messages':_0x199ddf,'endOfRunMessage':_0x50b9be,'taskExecutions':_0x301f29,'versionOfNxBefore133':_0x122771,'inner':_0x49647f,'encryptionKey':_0x4a9e20,'fileStorage':_0x49cbe9,'uploadInCurrentProcess':_0x48f654,'runContext':_0x523a2f});_0x45fbc2['complete']();})});return _0x45fbc2;}else{return _0x423ca8[a1_0x16c9('0x49')](_0x4c6c36=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x2a1776['daemon'],'lifeCycle':_0x200f1d,'options':_0x3370b6,'remoteCache':_0x3d5a81,'api':_0x1d699d,'outputObfuscator':_0x29ff8c,'runStartTime':_0x57882c,'messages':_0x199ddf,'endOfRunMessage':_0x50b9be,'taskExecutions':_0x301f29,'versionOfNxBefore133':_0x122771,'inner':_0x49647f,'encryptionKey':_0x4a9e20,'fileStorage':_0x49cbe9,'uploadInCurrentProcess':_0x48f654,'runContext':_0x523a2f});return _0x4c6c36;}))[a1_0x16c9('0x4e')](_0x3f9fdb=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0x2a1776[a1_0x16c9('0x10')],'lifeCycle':_0x200f1d,'options':_0x3370b6,'remoteCache':_0x3d5a81,'api':_0x1d699d,'outputObfuscator':_0x29ff8c,'runStartTime':_0x57882c,'messages':_0x199ddf,'endOfRunMessage':_0x50b9be,'taskExecutions':_0x301f29,'versionOfNxBefore133':_0x122771,'inner':_0x49647f,'encryptionKey':_0x4a9e20,'fileStorage':_0x49cbe9,'uploadInCurrentProcess':_0x48f654,'runContext':_0x523a2f});throw _0x3f9fdb;}));}}exports[a1_0x16c9('0x1f')]=cloudEnabledTasksRunner;